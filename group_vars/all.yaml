#
# Global variables for all nodes
#
---

#If set to true it will reset the K8S cluster on each run
K8S_RESET: false

# microk8s
MICROK8S_BIN: /snap/bin/microk8s
KUBECTL_BIN: /snap/bin/microk8s kubectl
DOCKER_USER: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39353438346635386437643834303766353339336230623766666333626562323231613538656162
          3464666163346534396430363334353332666538393666650a646261633130616532396432363766
          36326135643430373137623161623034636261373337353264376666306337363838633463633631
          6439326236313533370a386365313733303434333336306431623662373136346532386232376163
          3133
DOCKER_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31363537636635666164343266306333643939616438636230313366316664653130616336366333
          3134613336663633343830313539373432613662613437340a306438373664393962623835366236
          31353065303634303262393366616536376336663964393566636661353164313261396634356634
          3337356332393566360a393661346432333539633830353432626263643531386165646134383330
          6463
# example.com
MICROK8S_DOMAIN: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61343737376634383366643238383335373363346263363432316166333839323838633638613763
          3137636135663966363163353430346538363064376237370a366535663061626464666432656165
          34376238653836363165313765383838656164383034663636306539386261386466306539656230
          3737646430303365350a326137376333373235323761343065373230343039373963666335316636
          6533
MICROK8S_ADDONS:
- dns
#- metallb:192.168.1.128-192.168.1.191
- multus
- helm3
- metrics-server

# Kubernetes version
K8S_VERSION: "{{ '1.17*' if production else '1.17*'}}"

#kubeadm options
KUBEADM_OPTS_INIT: #  "--ignore-preflight-errors=SystemVerification" #Ignore btrfs
KUBEADM_APISERVER_HOST: "{{ 'k8s-api.'+MICROK8S_DOMAIN if production else 'k8s-test-api.'+MICROK8S_DOMAIN }}"
KUBEADM_APISERVER_IP:   "{{ '192.168.2.201'       if production else '192.168.2.203'            }}"
KUBEADM_APISERVER_PORT: 6443
KUBEADM_NODE_PORTRANGE: 30000-32000
KUBEADM_OIDC_ISSUER_URL: "{{ 'https://oidc.' + MICROK8S_DOMAIN }}"
KUBEADM_CRI_SOCKET: "{{ '/var/run/crio/crio.sock' if uses_crio else '/run/containerd/containerd.sock'            }}"
KUBEADM_OIDC_CLIENT_ID: ingress

KUBEADM_CFG: /etc/kubernetes/kubeadmcfg.yaml

#Kubelet options
KUBELET_OPTS: ""

# Kubernetes dashboard
#K8S_DASHBOARD_IMAGE: angelnu/kubernetes-dashboard:v1.10.0

timezone: "Europe/Berlin"
ssh:
  pub_key_path: "~/.ssh/id_rsa.pub"
BOOTSTRAP_PACKAGES:
  - apt-transport-https
  - aptitude
PACKAGES:
  - docker-ce=5:18.09.*
  - kubeadm={{ K8S_VERSION }}
  - kubelet={{ K8S_VERSION }}
  - kubectl={{ K8S_VERSION }}
  - rsync
  - glusterfs-client
  - nfs-common
  - attr
  - conntrack
  - vim
  - git
  - ansible #For ansible-vault
PACKAGES2REMOVE:
  - zram-config
  - sendmail-base
  - libnss-mdns #It uses multicast dns to resol .local -> conflicts with k8s dns names: https://askubuntu.com/questions/81797/nslookup-finds-ip-but-ping-doesnt


SSH_PUB_KEYS_2_INSTALL:
- description: Windows key
  value: ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEAjsC7lRkcXPBluRyhA0EWNgOFlc1dg4TxxwOIwCXW6k3KEAUBCV7q6HEHY7W4qmoGvCPREvBT9l1nY8mB9pWeCdExIiGfJKKEUfGpjglMNdFq3/ONGoHjJaTlrXDG9Pr4FSpGpyYhhkTEcusmIWTQgqCh+qV8r9zqaNj/ocHolf7BoeZJbQ7RfrDgKqUcP5cPvD5tLfsdYTS7sSkhRDuXksbrt7PHleZrrg3VqxRdRKf2JtHoeD6kDfsimJwRc+X/LLC60EytBrqiGtbreMklB4hGpl/iySuTx7d29UZDi9LKFurkO50+WBKLApGlwrLU8gpBxhT+NdBDoc5t9JwFyw== windowsPutty
- description: Laptop key
  value: ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAC/8OR+845gri1Ov0FQDy52mD4ve3f/KXVl8DDyAqowpqTCQbFqu8qV/Jlc0px1fIU74gfcM1NgcqCCtzA3gMEwdQAfNH6+xP9icVKjkQoE3qFWNbfJs9SkAiIaB2yp84/Iu2oY2JjbWQUqoYJM9JXwWtoFjVCIY+a/APeFCaHPZbX4bQ== user@laptop
- description: Macbook key
  value: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCkObbalGeAteH/EMAl0VB790qM7s4U4FaOFRFxU91J4c8Cmjfov+YxiBz2hyWHqAtNwIFjp5nac9oZ71uX2EeUjFd6SvxSQK9h5EpVe0U4ZgAOVK3pzRR+COsHgr6gmBdE06WQR5xK04bDt9gyx5ZrgqNREPqj8eHqs5DoN+PSkw0lZvm4PMtpvsCig3/6yyV95HmhfnCxWdk/C3OjLElut2XR3esRZGXp2pWGAz97RmAxJD4EaDj29V8czlm//8VKAMJMXrZ6tbr2p++C5syEE/B6MkLpjZgsA9xIFmcQbbo1Drqz0OAOVAF4fyk3eH9maG68ksOX0ogixlVQ3eBd user@MacBook-Pro.local
- description: Nas key
  value: ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBADC2WHe1Z1C+ysjmEOie5C7cB5TLth7/2DA6I23s0QRU3Tk9NNpygnSeQB66fSpWntgUP8r7kpHI4cK1STo651bqwDgPSqWne+qfRvW8TkEoAhrDHC3czIwbVzgXdf0OBlZ1DQin1HRsLbsr4TlssgX4gRZgf4pTu/3lUDOO2JqJRJ91g== root@nas
- description: Server key
  value: ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAHRwJSmkSt/yataayHydu9qNUMfC07gP/p+kYOjvOxVIoXPboQAfWf8HDucD48FgPoNWv7NgPhl+5Z2f0jWKQpz2QEFEGs48ndsy9bTFQrgxhn8LVOhHTp1MXfhUuRmT1LoCiy2wEJJlCP8b5hMSk6eZipeKdYo+G3tFKArKAGJ5NVzAw== root@server

SSH_FILES_2_INSTALL:
  id_ecdsa.pub: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61616533303861656431636330653061383934303866323432343861313265373739316334376638
          6134653437623565353461313332353637313865626336650a353437323539626364616135343430
          34643666643931646236613333343866386534653363346233386463636564373439653264363961
          3365356364336131620a306334623730366638613562303230663663303033373530306535663835
          34316665623038666234633735373036636232346636346139643634303762393362356138353835
          35383138376233633363333362313639366465623636623536373033383131303733613832373866
          31366238303436646437623338393938363630663135616563333734633464663763623662306161
          35363462653561303062353762663533633836336334373965616666353237333536376162653630
          63646439333965633934383364323639646635663330393233643239613131666332366662396239
          38613636353233616266633766656330623765353139636361326434313830393439326431353137
          63383236373338376634613035643630386537313533343635636332393430653866313235623935
          66363733666136313039333331663262323837386632353535663464373039613131633061616538
          33393233363135346538613030346539333031346439623632356464633831656633633465353138
          38636561346465346361356565363334633939353433333939616263623932303436636334356163
          37626166653034623731313930323630653962313764633537356331636630366664353864383235
          33316639346530656330353263666566636637356237613635303461303235613638663133363533
          36316365336362323436323337376336346566653634343533653235363065393562313462393265
          6232366332333465633861653863623964626334616164626664
  id_ecdsa: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37393664663530326533643430376331306638616537616539653630383465393735333935636462
          3930663365396461653036376663366366343930323336360a353235363737623764396464623734
          66616333303433636439383332383538343563646536346564373564623234613238303837343861
          3164336166313064650a396433333336653339396538326362363335303064613265396532666565
          34663061373038323439363361383230366432306438386232396332356236363233313262613339
          38343364303134336538316161306363643438316239613232313238613461663333306236626331
          30396663326533376534343131313835356337386565656530313931653330656234356462663234
          33346235643962343831336336376531303362346232373431366464636162386365626164633863
          32353533313566396331313466353731346236313739363931393661303537393261393461663432
          62356464636561643639333063383930633334646139613664353562343165633034663564303366
          65343532623162323932646564623234336138346262653232386537306132636635656337653738
          62393637323266626631623734323231363836636662376265663562376133636239343361613533
          38303464656466333165613632396430636439356233383737393336663730623839383638383065
          65353363326130376636663238336265326433613432336239316536343434666532383931636464
          36356637306632386631373434316432633035323466653164303163363262323434306362613336
          36323231613435663361303461353536306239656534656566343161633666613963323130396630
          34393665303833386132646136336132616562366164393133626530333932306564666336393263
          34363831346365356661646438366130663437633261613433613732393262666636633036373230
          61396565653231373266653932666332626232303462613064343435353666316235653565303963
          31306666353030333264653531623336303539363562363737303037386662323839303062623338
          66653063623736616464336633393833653231666531396162323439386132326362336234316433
          6633393032306536366666636663613131656438656630623431


ALIAS_2_INSTALL:
  kubectl: microk8s kubectl
  helm: microk8s helm3
  getpods: microk8s kubectl get pod -A
  delpod: microk8s kubectl delete pod
  descpod: microk8s kubectl describe pod
  execpod: microk8s kubectl exec -ti
  logpod: microk8s kubectl logs
  vault-edit: "EDITOR='code --wait' ansible-vault edit"

# Generated
KUBELET_PRIMARY_MASTER_HOSTNAME: "{{ groups['masters'][0] }}"

#Local K8S files
K8S_LOCAL_KUBELET_CFG_PATH: "{{ './kubeconfig' if production else './kubeconfig-test' }}"

#K8S files in the server
K8S_ETC_PATH: /etc/kubernetes
K8S_KUBELET_CFG_PATH: /etc/kubernetes/kubelet.conf
K8S_ADMIN_CFG_PATH: /etc/kubernetes/admin.conf

#Environment varibles for kubectl
KUBECTL_ENV:
  KUBECONFIG: "{{K8S_ADMIN_CFG_PATH}}"

#Environment varibles for kubectl
LOCAL_KUBECTL_ENV:
  KUBECONFIG: "{{ K8S_LOCAL_KUBELET_CFG_PATH }}/admin.conf"
